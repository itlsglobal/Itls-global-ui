<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ITLS</title>
  <link rel="stylesheet" href="/css/pages/styles.css" />
  <link rel="stylesheet" href="css/themes/creamy_gray_theme_minimal.css" />
  <!-- <link rel="stylesheet" href="css/secondPage/secondPageStyles.css" /> -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <!-- MDB CSS for ripple effect -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.css" rel="stylesheet" />

  <!-- Tailwind CDN for utility classes -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
</head>

<body
  style="background: url('https://via.placeholder.com/1920x1080.png?text=Test+Background') no-repeat center center fixed; background-size: cover; position: relative;">
  <div class="page-wrapper">
    <div class="main-content">
      <!-- Forgot-password modal removed (header simplified to logo-only) -->

      <!-- Overlay container -->
      <div id="overlay"
        style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 20000;">
        <iframe src="pages/registration/membership-options.html"
          style="width: 100%; height: 90%; margin-top: 15px; border: none;"></iframe>
      </div>

      <section id="top-header" class="header-section">
        <div class="container-fluid" style="padding-top: 0; padding-bottom: 0;">
          <div class="row p-0 align-items-center">
            <!-- LEFT: Logo -->
            <div class="col-12 col-sm-4">
              <div class="d-flex align-items-center justify-content-center justify-content-md-start">
                <a href="/index.html">
                  <img class="logo" style="height: 80px; width: auto; margin-top: 1px; margin-left: 8px;"
                    src="./assets/images/LOGOITLS.png" alt="ITLS Logo" />
                </a>
              </div>
            </div>

            <!-- RIGHT: Login / Register -->
            <div class="col-12 col-sm-8">
              <div class="d-flex justify-content-center justify-content-sm-end align-items-center gap-3 pe-4">
                <button class="btn btn-outline-primary px-4 py-2 fw-semibold" onclick="openLoginOverlay()">
                  Login
                </button>

                <button class="btn btn-primary px-4 py-2 fw-semibold" onclick="openMembershipOverlay()">
                  Register
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- User profile dropdown removed from header (header simplified to logo-only) -->

      <section class="menu-section" style="margin-top: -5px;">
        <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
          <div class="menu-bg"
            style="display: flex; justify-content: flex-start; gap: 80px; padding: 5px 0 5px 0; padding-left: 0; margin-left: 100; position: relative;">
            <div class="menu-box" style="width: 160px; margin-left: 0;">
              <div class="menu-wp" style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <div class="menu-item-yellow" onclick="window.location.href='pages/menu/menu.html'"
                  onmouseover="this.style.boxShadow='0 12px 30px rgba(0,0,0,0.5)'; this.style.transform='translateY(-8px)';"
                  onmouseout="this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'; this.style.transform='translateY(0)';">
                  <div
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 10px; ; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                  </div>
                  <span style="font-size: 1.4rem;font-weight: bold;">üìö Skill</span>
                </div>
              </div>
            </div>
            <div class="menu-box" style="width: 160px; margin-left: 0;">
              <div class="menu-wp" style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <div class="menu-item-yellow" onclick="window.location.href='pages/menu/menu.html'"
                  onmouseover="this.style.boxShadow='0 12px 30px rgba(0,0,0,0.5)'; this.style.transform='translateY(-8px)';"
                  onmouseout="this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'; this.style.transform='translateY(0)';">

                  <div
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 10px; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                  </div>
                  <span
                    style="display: flex; align-items: center; gap: 6px; font-weight: bold; font-size: 1.2rem; margin-top: 8px; display: inline-flex;">
                    <span>üèóÔ∏è</span>
                    <span>Skill Bulding</span>
                  </span>
                </div>
              </div>
            </div>
            <div class="menu-box" style="width: 160px; margin-left: 0;">
              <div class="menu-wp" style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <div class="menu-item-yellow" onclick="window.location.href='pages/menu/menu.html'"
                  onmouseover="this.style.boxShadow='0 12px 30px rgba(0,0,0,0.5)'; this.style.transform='translateY(-8px)';"
                  onmouseout="this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'; this.style.transform='translateY(0)';">
                  <div
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 10px; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                  </div>
                  <span
                    style="display: flex; align-items: center; gap: 6px; font-weight: bold; font-size: 1.2rem; margin-top: 8px; display: inline-flex;">
                    <span>üìù</span>
                    <span>Skill Evaluation</span>
                  </span>
                </div>
              </div>
            </div>
            <div class="menu-box" style="width: 160px; margin-left: 0;">
              <div class="menu-wp" style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <div class="menu-item-yellow" onclick="window.location.href='pages/menu/menu.html'"
                  onmouseover="this.style.boxShadow='0 12px 30px rgba(0,0,0,0.5)'; this.style.transform='translateY(-8px)';"
                  onmouseout="this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'; this.style.transform='translateY(0)';">
                  <div
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 10px;border-top-left-radius: 8px; border-top-right-radius: 8px;">
                  </div>

                  <div
                    style="position: absolute; top: 8px; left: 0; width: 100%; height: 10px; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                  </div>
                  <span
                    style="display: flex; align-items: center; gap: 6px; font-weight: bold; font-size: 1.2rem; margin-top: 8px; display: inline-flex;">
                    <span>üîç</span>
                    <span>Skill Analysis</span>
                  </span>
                </div>
              </div>
            </div>
            <div class="menu-box" style="width: 160px; margin-left: 0;">
              <div class="menu-wp" style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <div class="menu-item-yellow" onclick="window.location.href='pages/menu/menu.html'"
                  onmouseover="this.style.boxShadow='0 12px 30px rgba(0,0,0,0.5)'; this.style.transform='translateY(-8px)';"
                  onmouseout="this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'; this.style.transform='translateY(0)';">
                  <div
                    style="position: absolute; top: 0; left: 0; width: 100%; height: 10px; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                  </div>
                  <span style="font-size: 1.3rem; font-weight: bold;">üõ†Ô∏è Support</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="container-fluid">
        <div class="row px-5">
          <div class="col-2 col-sm-2 p-4 d-block">
            <h5 class="grade-nav-title mb-3 text-center"><i class="fas fa-book"></i> Grade Levels</h5>
            <div class="btn-group-vertical grade-nav-buttons" role="group" aria-label="Vertical button group">
              <button type="button" class="btn btn-primary custom-primary grade-btn pre-k mb-2" data-grade-id="0">
                <i class="fas fa-graduation-cap me-2"></i> Pre-K
              </button>
              <button type="button" class="btn btn-primary custom-primary grade-btn grade-1 mb-2" data-grade-id="1">
                <i class="fas fa-child me-2"></i> 1st-Grade
              </button>
              <button type="button" class="btn btn-primary custom-primary grade-btn grade-2 mb-2" data-grade-id="2">
                <i class="fas fa-book-reader me-2"></i> 2nd-Grade
              </button>
              <button type="button" class="btn btn-primary custom-primary grade-btn grade-3 mb-2" data-grade-id="3">
                <i class="fas fa-pencil-alt me-2"></i> 3rd-Grade
              </button>
              <button type="button" class="btn btn-primary custom-primary grade-btn grade-4 mb-2" data-grade-id="4">
                <i class="fas fa-calculator me-2"></i> 4th-Grade
              </button>
              <button type="button" class="btn btn-primary custom-primary grade-btn grade-5" data-grade-id="5">
                <i class="fas fa-flask me-2"></i> 5th-Grade
              </button>
            </div>
          </div>
          <div class="col-12 col-sm-8 pb-5">
            <div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel"
              data-bs-interval="3000">
              <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active"
                  aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1"
                  aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="2"
                  aria-label="Slide 3"></button>
              </div>
              <div class="carousel-inner">
                <div class="carousel-item active" data-bs-interval="3000">
                  <div class="sld-box">
                    <img class="slider-img" src="../../assets/images/sld1.PNG" />
                  </div>
                  <div class="carousel-caption d-none d-md-block">
                    <!-- <h5>First slide label</h5>
                    <p>
                      Some representative placeholder content for the first slide.
                    </p> -->
                  </div>
                </div>
                <div class="carousel-item" data-bs-interval="2000">
                  <div class="sld-box">
                    <img class="slider-img"
                      src="https://img.freepik.com/free-photo/school-children-busy-writing-notes-using-digital-tablet-class_23-2148039920.jpg?w=996&t=st=1711206205~exp=1711206805~hmac=ee0c82daf8f5dc018ebdd6dab0a752528275e1cb6c507f387637f5953ae36e68" />
                  </div>
                  <div class="carousel-caption d-none d-md-block">
                    <!-- <h5>Second slide label</h5>
                    <p>
                      Some representative placeholder content for the second
                      slide.
                    </p> -->
                  </div>
                </div>
                <div class="carousel-item">
                  <div class="sld-box">
                    <img class="slider-img"
                      src="https://img.freepik.com/free-photo/positive-student-with-classmates-background_1098-2630.jpg?w=1060&t=st=1711206105~exp=1711206705~hmac=806e147d3372bd685cf31d4ba00c4223198c18648c674e4264aedbc8a5bf0e29" />
                  </div>
                  <div class="carousel-caption d-none d-md-block">
                    <!-- <h5>Third slide label</h5>
                    <p>
                      Some representative placeholder content for the third slide.
                    </p> -->
                  </div>
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <div class="container-xxl grade-container">
        <div class="grade-header">
          <div class="section-title-wrapper">
            <h1 class="section-title"><i class="fas fa-graduation-cap title-icon"></i>Learn By Grade</h1>
            <div class="title-underline"></div>
          </div>
          <p class="section-subtitle">Choose your grade level to start exploring curriculum-aligned content</p>
        </div>
        <div class="max-w-7xl mx-auto px-4 py-8">
          <div id="grade-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
            <!-- Grade cards will be rendered here by JS -->
          </div>
        </div>
      </div>
      <script>
        fetch('../../data/grades/gradesData.json')
          .then(response => response.json())
          .then(data => {
            const gradeCardsContainer = document.getElementById('grade-cards-container');
            gradeCardsContainer.innerHTML = '';
            data.grades.forEach(grade => {
              let colorClass = '';
              switch (grade.grade_id) {
                case 0: colorClass = 'border-yellow-300 bg-yellow-200 text-yellow-800'; break;
                case 1: colorClass = 'border-purple-300 bg-purple-200 text-purple-800'; break;
                case 2: colorClass = 'border-cyan-300 bg-cyan-200 text-cyan-800'; break;
                case 3: colorClass = 'border-pink-300 bg-pink-200 text-pink-800'; break;
                case 4: colorClass = 'border-green-300 bg-green-200 text-green-800'; break;
                case 5: colorClass = 'border-orange-300 bg-orange-200 text-orange-800'; break;
                default: colorClass = 'border-gray-300 bg-gray-200 text-gray-800';
              }
              let subjectsHtml = '';
              let subjectNames = [];
              grade.subjects.forEach(subject => {
                subjectNames.push(subject.subject_name);
                let skillCount = 0;
                if (subject.skill_categories) {
                  subject.skill_categories.forEach(skill_category => {
                    skillCount += (skill_category.skills ? skill_category.skills.length : 0);
                  });
                }
                subjectsHtml += `
                <div class="flex items-center text-left w-full">
                  <span>${subject.subject_name}</span>
                  <span class="text-blue-600 cursor-pointer hover:underline ml-auto">${skillCount} skills ‚Üí</span>
                </div>
              `;
              });
              // Dynamic description based on present subjects
              let description = '';
              const subjectList = subjectNames.length === 1
                ? `<b>${subjectNames[0]}</b>`
                : subjectNames.length === 2
                  ? `<b>${subjectNames[0]}</b> and <b>${subjectNames[1]}</b>`
                  : subjectNames.length > 2
                    ? `<b>${subjectNames.slice(0, -1).join('</b>, <b>')}</b> and <b>${subjectNames[subjectNames.length - 1]}</b>`
                    : '';

              switch (grade.grade_id) {
                case 0:
                  description = subjectNames.length > 0
                    ? `Kindergarten is all about joyful beginnings! Kids discover the world through fun in ${subjectList}.`
                    : 'Kindergarten is all about joyful beginnings!';
                  break;
                case 1:
                  description = subjectNames.length > 0
                    ? `Grade 1 sparks curiosity with exciting lessons in ${subjectList}.`
                    : 'Grade 1 sparks curiosity and wonder.';
                  break;
                case 2:
                  description = subjectNames.length > 0
                    ? `Second grade builds confidence as students explore ${subjectList}.`
                    : 'Second grade builds confidence and skills.';
                  break;
                case 3:
                  description = subjectNames.length > 0
                    ? `Third grade encourages independent thinking with engaging topics like ${subjectList}.`
                    : 'Third grade encourages independent thinking.';
                  break;
                case 4:
                  description = subjectNames.length > 0
                    ? `Fourth grade deepens understanding through hands-on learning in ${subjectList}.`
                    : 'Fourth grade deepens understanding.';
                  break;
                case 5:
                  description = subjectNames.length > 0
                    ? `Fifth grade prepares students for new challenges with a rich mix of ${subjectList}.`
                    : 'Fifth grade prepares students for new challenges.';
                  break;
                default:
                  description = subjectNames.length > 0
                    ? `A wonderful year of learning in ${subjectList}.`
                    : 'A wonderful year of learning.';
              }
              gradeCardsContainer.innerHTML += `
              <div class="relative w-full ${colorClass.split(' ')[0]} rounded-xl p-7 flex flex-col justify-between min-h-[320px] bg-white grade-card-shadow" onclick="window.location.href='pages/home/secondPage.html?grade=${grade.grade_id}'">
                <div class="grade-card-header">
                  <div class="grade-circle ${colorClass}">${grade.grade_id === 0 ? 'KG' : grade.grade_id}</div>
                  <h2 class="grade-card-title ${colorClass.split(' ').find(cls => cls.startsWith('text-'))}">${grade.grade_name}</h2>
                </div>
                <p class="text-gray-700 text-base leading-relaxed mb-6 text-left">${description}</p>
                <div class="w-full h-px bg-gray-200 my-2"></div>
                <div class="space-y-3 text-base font-semibold text-gray-600 text-left">
                  ${subjectsHtml}
                </div>
              </div>
            `;
            });
          });
      </script>
      <footer class="footer">
        <div class="container footer-container-wrapper">
          <div class="row footer-container py-3">
            <div class="col-md-3 col-sm-6 footer-section">
              <div class="brand-section">
                <h2 class="footer-logo">ITLS</h2>
                <p class="footer-tagline mb-2">Interactive Teaching & Learning System</p>
                <!-- <button class="join-btn" onclick="window.location.href='/pages/registration/family-registration.html'"><i class="fas fa-user-plus me-2"></i>Join now</button> -->
              </div>
            </div>
            <div class="col-md-3 col-sm-6 footer-section">
              <h3 class="footer-heading"><i class="fas fa-book-open me-2"></i>What we offer</h3>
              <ul class="footer-links">
                <li><i class="fas fa-calculator me-2"></i>Mathematics</li>
                <li><i class="fas fa-language me-2"></i>English</li>
                <li><i class="fas fa-flask me-2"></i>Science</li>
                <li><i class="fas fa-globe-americas me-2"></i>Social Studies</li>
              </ul>
            </div>
            <div class="col-md-3 col-sm-6 footer-section">
              <h3 class="footer-heading"><i class="fas fa-info-circle me-2"></i>About</h3>
              <ul class="footer-links" style="margin-top: 0.5rem">
                <li><a href="contact-us.html"><i class="fas fa-envelope me-2"></i>Contact Us</a></li>
                <li><a href="terms-of-service.html"><i class="fas fa-gavel me-2"></i>Terms of Service</a></li>
                <li><a href="privacy-policy.html"><i class="fas fa-shield-alt me-2"></i>Privacy Policy</a></li>
              </ul>
            </div>
            <div class="col-md-3 col-sm-6 footer-section">
              <h3 class="footer-heading"><i class="fas fa-users me-2"></i>Connect Us</h3>
              <div class="social-icons">
                <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
                <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12 text-center footer-bottom">
              <p class="mb-0">&copy; 2023 ITLS. All rights reserved.</p>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <!-- MDB JavaScript for ripple effect -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"></script>
    <script src="/js/landingPage/script.js"></script>
    <script>
      // Initialize MDB Ripple effect
      document.addEventListener('DOMContentLoaded', function () {
        // Initialize ripple effect on buttons with data-mdb-ripple-init attribute
        const rippleElements = document.querySelectorAll('[data-mdb-ripple-init]');
        rippleElements.forEach(function (element) {
          new mdb.Ripple(element);
        });
      });
    </script>
    <script>

      // Dropdown user type selection logic
      document.querySelectorAll('.dropdown-menu.tiny-dropdown a').forEach(item => {
        item.addEventListener('click', function (e) {
          e.preventDefault();
          const selectedText = this.textContent.trim();
          const userTypeBtn = document.querySelector('.user-type-btn');
          if (userTypeBtn) {
            userTypeBtn.textContent = selectedText;
          }
        });
      });

      // Reposition the whoami-menu dropdown on Bootstrap dropdown show event
      const userTypeBtn = document.getElementById('languageDropdown');
      const whoamiMenu = document.querySelector('.whoami-menu');
      const whoamiDropdown = document.querySelector('.whoami-dropdown');
      let originalParent = whoamiMenu.parentNode;
      let originalNextSibling = whoamiMenu.nextSibling;

      if (userTypeBtn && whoamiMenu && whoamiDropdown) {
        let originalParent = whoamiMenu.parentNode;
        let originalNextSibling = whoamiMenu.nextSibling;

        userTypeBtn.addEventListener('show.bs.dropdown', () => {
          // Move dropdown menu to body to avoid clipping and stacking context issues
          document.body.appendChild(whoamiMenu);
        });

        userTypeBtn.addEventListener('shown.bs.dropdown', () => {
          const rect = userTypeBtn.getBoundingClientRect();
          whoamiMenu.style.position = 'fixed';
          whoamiMenu.style.top = (rect.bottom) + 'px';
          whoamiMenu.style.left = rect.left + 'px';
          whoamiMenu.style.zIndex = '110000';
        });

        userTypeBtn.addEventListener('hide.bs.dropdown', () => {
          // Move dropdown menu back to original container
          if (originalNextSibling) {
            originalParent.insertBefore(whoamiMenu, originalNextSibling);
          } else {
            originalParent.appendChild(whoamiMenu);
          }
          whoamiMenu.style.position = '';
          whoamiMenu.style.top = '';
          whoamiMenu.style.left = '';
          whoamiMenu.style.zIndex = '';
        });
      }



      // Initialize carousel with auto-sliding
      document.addEventListener('DOMContentLoaded', function () {
        var myCarousel = document.getElementById('carouselExampleDark');
        var carousel = new bootstrap.Carousel(myCarousel, {
          interval: 3000,
          wrap: true,
          ride: 'carousel'
        });
      });


      // Forgot password modal functions
      function openModal() {
        document.getElementById('forgot-password-modal').style.display = 'block';
      }

      function closeModal() {
        document.getElementById('forgot-password-modal').style.display = 'none';
      }

      // function sendResetLink() {
      //   const email = document.getElementById('reset-email').value;
      //   if (email) {
      //     alert('Password reset link has been sent to ' + email);
      //     closeModal();
      //   } else {
      //     alert('Please enter your email address');
      //   }
      // }

      // ...existing code...
      function sendResetLink() {
        const email = document.getElementById('reset-email').value;
        if (email) {
          // Prepare the payload
          const formData = { email: email };

          // Use the actual backend endpoint
          const apiUrl = 'http://localhost:8082/itls/forgot-password';

          // Send POST request
          fetch(apiUrl, {
            method: 'POST',
            headers: {
              'accept': '*/*',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
          })
            .then(response => {
              if (response.ok) {
                alert('Password reset link has been sent to ' + email);
                closeModal();
              } else {
                alert('Failed to send reset link. Please try again.');
              }
            })
            .catch(error => {
              alert('Error sending request: ' + error);
            });
        } else {
          alert('Please enter your email address');
        }
      }
      // ...existing code...

      // Overlay removed: membership modal handled via dedicated registration page

      // Logout functionality
      document.getElementById('logout-btn')?.addEventListener('click', function () {
        localStorage.removeItem('loggedInUser');
        window.location.reload();
      });

      document.getElementById('logout-dropdown-btn')?.addEventListener('click', function () {
        localStorage.removeItem('loggedInUser');
        window.location.reload();
      });

      // Check if user is logged in on page load
      window.addEventListener('load', function () {
        const loggedInUser = localStorage.getItem('loggedInUser');
        if (loggedInUser) {
          const user = JSON.parse(loggedInUser);
          const loginFormEl = document.getElementById('login-form');
          if (loginFormEl) loginFormEl.style.display = 'none';
          const welcomeContainer = document.getElementById('welcome-container');
          if (welcomeContainer) welcomeContainer.style.display = 'flex';
          // Set user initial to first valid letter (A-Z, a-z) from username or email, uppercase
          let initial = '';
          let source = (user.username && typeof user.username === 'string' && user.username.trim().length > 0)
            ? user.username.trim()
            : (user.email && typeof user.email === 'string' && user.email.trim().length > 0 ? user.email.trim() : '');
          if (source) {
            let match = source.match(/[A-Za-z]/);
            if (match) initial = match[0].toUpperCase();
          }
          const userInitialEl = document.getElementById('userInitial');
          if (userInitialEl) userInitialEl.textContent = initial;
          // Set the welcome message text
          const welcomeEl = document.getElementById('typewriter-welcome');
          if (welcomeEl) {
            if (user.username) {
              welcomeEl.innerHTML = `Welcome<br>${user.username}`;
            } else {
              welcomeEl.innerHTML = 'Welcome';
            }
          }
          // Also update user profile dropdown initial and title attribute if present
          const userDropdownBtn = document.getElementById('userDropdown');
          if (userDropdownBtn) {
            userDropdownBtn.title = `${user.username || user.email || ''} (${user.userType || ''})`;
          }
        }
      });

      // Overlay login helper removed

      // Sidebar grade button click handler (guaranteed to run after DOM is loaded)
      document.querySelectorAll('.grade-btn[data-grade-id]').forEach(btn => {
        btn.onclick = function () {
          const gradeId = this.getAttribute('data-grade-id');
          if (gradeId !== null) {
            window.location.href = 'pages/home/secondPage.html?grade=' + gradeId;
          }
        };
      });
    </script>
    <script>
      console.log('Sidebar grade handler script loaded');
      // Remove debug pointer-events CSS if present
      const debugStyle = document.querySelector('style#debug-pointer-events');
      if (debugStyle) debugStyle.remove();

      // Remove all previous click handlers (if any)
      document.querySelectorAll('.grade-btn[data-grade-id]').forEach(btn => {
        btn.replaceWith(btn.cloneNode(true));
      });

      // Attach handler to render src/Home/index.html for the selected grade
      console.log('Attaching sidebar grade button handler...');
      document.querySelectorAll('.grade-btn[data-grade-id]').forEach(btn => {
        btn.onclick = function () {
          const gradeId = this.getAttribute('data-grade-id');
          if (gradeId !== null) {
            window.location.href = 'pages/home/secondPage.html?grade=' + gradeId;
          }
        };
      });
    </script>
    <script>
      // Hide 'Join now' button if user is logged in
      window.addEventListener('load', function () {
        if (localStorage.getItem('loggedInUser')) {
          var joinBtn = document.getElementById('join-now-btn');
          if (joinBtn) joinBtn.style.display = 'none';
        }

        // Check if we need to open the membership overlay automatically
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('openMembership') === 'true') {
          // Redirect to registration page instead of showing overlay
          window.location.href = '/pages/registration/family-registration.html';
        }
      });
    </script>
    <script>
      function openMembershipOverlay() {
        const overlay = document.getElementById("overlay");
        const iframe = overlay.querySelector("iframe");

        iframe.src = "/pages/registration/membership-options.html";
        overlay.style.display = "block";
      }

      // Listen for close message from iframe
      window.addEventListener("message", function (event) {
        if (event.data === "close-membership-overlay") {
          const overlay = document.getElementById("overlay");
          const iframe = overlay.querySelector("iframe");

          overlay.style.display = "none";
          iframe.src = ""; // cleanup
        }
      });
    </script>
    <script>
      function openLoginOverlay() {
        const overlay = document.getElementById("overlay");
        const iframe = overlay.querySelector("iframe");

        iframe.src = "/pages/auth/login.html";
        overlay.style.display = "block";
      }
      window.addEventListener("message", (event) => {
      // optional safety check
      // if (event.origin !== window.location.origin) return;

      if (event.data === "close-overlay") {
        const overlay = document.getElementById("overlay");

        if (!overlay) return;

        const iframe = overlay.querySelector("iframe");
        if (iframe) iframe.src = "";

        overlay.style.display = "none";
      }
    });
    </script>
</body>

</html>